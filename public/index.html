<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>3äººãƒãƒ¼ãƒ  æˆç¸¾è¡¨ï¼ˆãã®å ´é™ã‚Šï¼‰</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app" class="wrap">
  <h1 class="page-title">rec3on3.web.app</h1>
  <div class="toolbar">
    <button class="btn" @click="addMatchup">ï¼‹ ãƒãƒƒãƒã‚¢ãƒƒãƒ—ã‚’è¿½åŠ </button>
    <button class="btn secondary" @click="resetAll">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
  <table>
    <thead>
      <tr>
        <th v-for="(p,i) in players" :key="i" @click="openPlayerModal(i)" class="player-header">
          <div class="player-name">{{ p.name }}</div>
          <div class="player-char">{{ p.colors.join('') }} {{ p.char }}</div>
        </th>
        <th class="team-header">ãƒãƒ¼ãƒ </th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="(row, rIdx) in matchups" :key="row.id">
        <td colspan="4">
          <div class="row">
            <div class="cell" v-for="(cell, cIdx) in row.cells" :key="cIdx" @click="openModal(rIdx,cIdx)">
              <template v-if="cellFilled(cell)">
                <div v-html="formatCell(cell)"></div>
              </template>
              <template v-else>
                <div style="color:#888;">ã‚¿ãƒƒãƒ—ã—ã¦å…¥åŠ›</div>
              </template>
            </div>
            <div class="cell team" @click="openDeleteModal(rIdx)">
              <div :class="teamClass(teamOutcome(row))">{{ teamMark(teamOutcome(row)) }}</div>
            </div>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚»ãƒ«ç·¨é›† -->
  <div class="modal-backdrop" :style="{display: modal.open?'block':'none'}">
    <div class="modal">
      <div class="modal-head">
        <div v-if="modal.playerIdx !== null">{{ players[modal.playerIdx].name }} - {{ modal.rIdx + 1 }}æˆ¦ç›®</div>
        <button class="btn secondary" @click="closeModal">é–‰ã˜ã‚‹</button>
      </div>
      <div class="field">
        <label>ç›¸æ‰‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è‰²</label>
        <div class="colors">
          <span v-for="c in colorOptions" :key="'opp-'+c.key" class="color-pill" :class="{active: modal.buf.oppColors.includes(c.icon)}" @click="toggleColor('oppColors',c.icon)">{{ c.icon }}</span>
        </div>
      </div>
      <div class="field">
        <label>ç›¸æ‰‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å</label>
        <input class="input" v-model="modal.buf.oppChar" placeholder="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å">
      </div>
      <div class="field">
        <div class="radios">
          <span class="radio" :class="{active: modal.buf.order==='å…ˆè¡Œ'}" @click="modal.buf.order='å…ˆè¡Œ'">å…ˆè¡Œ</span>
          <span class="radio" :class="{active: modal.buf.order==='å¾Œæ”»'}" @click="modal.buf.order='å¾Œæ”»'">å¾Œæ”»</span>
        </div>
        <div class="radios">
          <span class="radio" :class="{active: modal.buf.result==='å‹ã¡'}" @click="modal.buf.result='å‹ã¡'">â­•ï¸ å‹ã¡</span>
          <span class="radio" :class="{active: modal.buf.result==='è² ã‘'}" @click="modal.buf.result='è² ã‘'">âŒï¸ è² ã‘</span>
        </div>
      </div>
      <div style="margin-top:12px;text-align:right;">
        <button class="btn secondary" @click="clearCell">ã‚¯ãƒªã‚¢</button>
        <button class="btn" @click="applyModal">åæ˜ </button>
      </div>
    </div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åç·¨é›† -->
  <div class="modal-backdrop" :style="{display: playerModal.open?'block':'none'}">
    <div class="modal">
      <div class="modal-head">
        <div>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’ç·¨é›†</div>
        <button class="btn secondary" @click="closePlayerModal">é–‰ã˜ã‚‹</button>
      </div>
      <div class="field">
        <label>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label>
        <input class="input" v-model="playerModal.name">
      </div>
      <div class="field">
        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è‰²</label>
        <div class="colors">
          <span v-for="c in colorOptions" :key="'player-'+c.key" class="color-pill" :class="{active: playerModal.colors.includes(c.icon)}" @click="togglePlayerColor(c.icon)">{{ c.icon }}</span>
        </div>
      </div>
      <div class="field">
        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å</label>
        <input class="input" v-model="playerModal.char">
      </div>
      <div style="margin-top:12px;text-align:right;">
        <button class="btn" @click="applyPlayerName">åæ˜ </button>
      </div>
    </div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ãƒãƒƒãƒã‚¢ãƒƒãƒ—å‰Šé™¤ -->
  <div class="modal-backdrop" :style="{display: deleteModal.open?'block':'none'}">
    <div class="modal">
      <div class="modal-head">
        <div>ãƒãƒƒãƒã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤</div>
        <button class="btn secondary" @click="closeDeleteModal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
      <div style="margin-bottom:16px;">
        <div style="font-weight:600; margin-bottom:8px;">{{ deleteModal.index + 1 }}å›ç›®ã®ãƒãƒƒãƒ</div>
        <div style="font-size:0.9rem; color:#666;">
          <div v-for="(cell, idx) in deleteModal.cells" :key="idx" style="margin-bottom:4px;">
            {{ players[idx].name }}: {{ formatDeleteCell(cell) }}
          </div>
        </div>
      </div>
      <div style="text-align:right;">
        <button class="btn secondary" @click="closeDeleteModal" style="margin-right:8px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn" style="background:#e05555;" @click="confirmDelete">å‰Šé™¤</button>
      </div>
    </div>
  </div>
</div>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>
const { createApp } = Vue;
createApp({
  data(){
    return {
      players:[
        {name:'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1',char:'',colors:[]},
        {name:'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2',char:'',colors:[]},
        {name:'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼3',char:'',colors:[]}
      ],
      matchups:[makeEmptyRow()],
      modal:{open:false,rIdx:null,cIdx:null,playerIdx:null,buf:{oppChar:'',oppColors:[],order:'',result:''}},
      playerModal:{open:false,index:null,name:'',char:'',colors:[]},
      deleteModal:{open:false,index:null,cells:[]},
      colorOptions:[
        {key:'red',icon:'ğŸŸ¥'},
        {key:'blue',icon:'ğŸŸ¦'},
        {key:'green',icon:'ğŸŸ©'},
        {key:'purple',icon:'ğŸŸª'},
        {key:'black',icon:'â¬›ï¸'},
        {key:'yellow',icon:'ğŸŸ¨'}
      ]
    }
  },
  methods:{
    addMatchup(){this.matchups.push(makeEmptyRow());},
    resetAll(){this.matchups=[makeEmptyRow()];},
    cellFilled(c){return c.oppChar||c.order||c.result;},
    teamOutcome(row){const res=row.cells.map(c=>c.result);const w=res.filter(x=>x==='å‹ã¡').length;const l=res.filter(x=>x==='è² ã‘').length;if(w>=2)return{type:'win'};if(l>=2)return{type:'lose'};return{type:'draw'};},
    teamClass(o){return{win:o.type==='win',lose:o.type==='lose',draw:o.type==='draw'};},
    teamMark(o){return o.type==='win'?'â—':o.type==='lose'?'Ã—':'â–³';},
    formatCell(cell){
      const resultSymbol = cell.result==='å‹ã¡'?'â­•ï¸':cell.result==='è² ã‘'?'âŒï¸':'';
      const parts = [
        cell.oppColors.join(''),
        cell.oppChar,
        `${cell.order}${resultSymbol}`
      ].filter(Boolean);
      return parts.join('<br>');
    },
    openModal(r,c){
      this.modal.open=true;
      this.modal.rIdx=r;
      this.modal.cIdx=c;
      this.modal.playerIdx=c;
      const currentCell = this.matchups[r].cells[c];
      this.modal.buf=JSON.parse(JSON.stringify(currentCell));
    },
    closeModal(){this.modal.open=false;},
    toggleColor(target,icon){const arr=this.modal.buf[target];const idx=arr.indexOf(icon);if(idx>=0)arr.splice(idx,1);else arr.push(icon);},
    applyModal(){this.matchups[this.modal.rIdx].cells[this.modal.cIdx]=JSON.parse(JSON.stringify(this.modal.buf));this.closeModal();},
    clearCell(){this.matchups[this.modal.rIdx].cells[this.modal.cIdx]={oppChar:'',oppColors:[],order:'',result:''};this.closeModal();},
    openPlayerModal(i){
      this.playerModal.open=true;
      this.playerModal.index=i;
      const player=this.players[i];
      this.playerModal.name=player.name;
      this.playerModal.char=player.char;
      this.playerModal.colors=JSON.parse(JSON.stringify(player.colors));
    },
    closePlayerModal(){this.playerModal.open=false;},
    togglePlayerColor(icon){
      const idx=this.playerModal.colors.indexOf(icon);
      if(idx>=0)this.playerModal.colors.splice(idx,1);
      else this.playerModal.colors.push(icon);
    },
    applyPlayerName(){
      const player=this.players[this.playerModal.index];
      player.name=this.playerModal.name;
      player.char=this.playerModal.char;
      player.colors=JSON.parse(JSON.stringify(this.playerModal.colors));
      this.closePlayerModal();
    },
    openDeleteModal(idx){
      this.deleteModal.open=true;
      this.deleteModal.index=idx;
      this.deleteModal.cells=this.matchups[idx].cells;
    },
    closeDeleteModal(){
      this.deleteModal.open=false;
    },
    confirmDelete(){
      this.matchups.splice(this.deleteModal.index,1);
      if(this.matchups.length===0)this.matchups.push(makeEmptyRow());
      this.closeDeleteModal();
    },
    formatDeleteCell(cell){
      if(!this.cellFilled(cell))return 'æœªå…¥åŠ›';
      const resultSymbol=cell.result==='å‹ã¡'?'â­•ï¸':cell.result==='è² ã‘'?'âŒï¸':'';
      return `${cell.oppColors.join('')}${cell.oppChar} ${cell.order}${resultSymbol}`;
    }
  }
}).mount('#app');
function makeEmptyRow(){return{id:Math.random().toString(36).slice(2),cells:[{oppChar:'',oppColors:[],order:'',result:''},{oppChar:'',oppColors:[],order:'',result:''},{oppChar:'',oppColors:[],order:'',result:''}]};}
</script>
</body>
</html>
